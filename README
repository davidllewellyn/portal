Ops-T Source Pool
2014-03-23 Vixie [original]

The Ops-T database permission architecture has the following invariants:

1. we use PostGreSQL 9.1 or later, which need not run on the same host w/ us;
2. our users and apps do not specify a username or password in PQconnect();
3. www (freebsd) and www-data (linux) and all sysadmins need to be in the ACL;
4. the "sysadmin" group has to have all the sysadmins in it as group members;
5. your pg_hba.conf file should permit the portal and mail hosts to connect.

Dev cycle is:

1. cd ~root/portal, edit, 'make'
2. sudo make install; test
3. consider restarting apache if you've changed a file it may have cached
4. consider installing some database updates
5. commit and push; consider going to other portals and doing 'git pull' etc

Install cycle is:

1. cd ~root/portal, clone, cp siteconfig.template siteconfig, edit, 'make'
2. sudo make install
3. cd /proj/ops-trust/library, and:
   3a. 'psql -h ... ops-trust < sysadmins.psql'
   3b. 'psql -h ... ops-trust < main-tg.psql'
4. do something about postfix
5. do something about apache
6. test

One then needs to add to /etc/aliases:
8<-------------
opstrust-mail-handler: "|/proj/ops-trust/library/mh-wrapper"
------------->8

and to /etc/postfix/virtual something similar to:
8<--------------
mail-handler@ops-trust.net	opstrust-mail-handler
@ops-trust.net			opstrust-mail-handler
------------->8

Of course configuring postfix properly and setting up Apache.

So, please note:

~root/portal is "the" checked out copy of the portal code right now. We are
not yet managing this with 'puppet' because of the 'siteconfig' file. Don't
freak out, just please don't make your own on-host clone and 'make install'
from it without also (a) warning the other sysadmins, (b) committing your
changes and pushing them, (c) pulling your changes into ~root/portal, making,
and 'sudo make install' from there, to ensure that it's really what's running.
